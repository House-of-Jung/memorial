<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>故 정 운 홍</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 50px;
            padding: 40px 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .profile-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 5px solid #ddd;
            margin: 0 auto 20px;
            background: #f0f0f0;
            overflow: hidden;
        }

        .profile-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-photo-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #666;
            background: #f0f0f0;
        }

        h1 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .dates {
            font-size: 1.2em;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .quote {
            font-style: italic;
            font-size: 1.1em;
            color: #34495e;
            max-width: 600px;
            margin: 0 auto;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: white;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-tab {
            padding: 12px 30px;
            margin: 0 5px;
            background: #ecf0f1;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: #3498db;
            color: white;
        }

        .nav-tab:hover {
            background: #2980b9;
            color: white;
        }

        .content-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .memory-card {
            background: #f8f9fa;
            padding: 25px;
            margin-bottom: 25px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .memory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .memory-author {
            font-weight: bold;
            color: #2c3e50;
        }

        .memory-date {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .memory-content {
            line-height: 1.8;
            color: #34495e;
        }

        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .photo-item {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .photo-item:hover {
            transform: translateY(-5px);
        }

        .photo-placeholder {
            width: 100%;
            height: 200px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 14px;
        }

        .photo-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-caption {
            padding: 15px;
            font-size: 0.9em;
            color: #555;
        }

        .life-story {
            columns: 2;
            column-gap: 30px;
            text-align: justify;
        }

        .life-story p {
            margin-bottom: 15px;
            break-inside: avoid;
        }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #3498db;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            padding-left: 30px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 5px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3498db;
        }

        .timeline-year {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .timeline-content {
            margin-top: 5px;
            color: #34495e;
        }

        .add-memory-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .add-memory-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .add-photo-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .add-photo-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }


        .footer {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
            font-style: italic;
        }

        /* 모달 스타일 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 15px;
            right: 20px;
        }

        .close:hover {
            color: black;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
        }

        .form-group textarea {
            height: 120px;
            resize: vertical;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            margin-right: 10px;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .auth-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-size: 14px;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                margin: 5px 0;
            }
            
            .life-story {
                columns: 1;
            }
            
            .photo-gallery {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
        }
    </style>
</head>
<body>
    <div class="auth-status" id="authStatus">
        <span id="authText">로그인이 필요합니다</span>
        <button onclick="showAuthModal()" id="authBtn" class="btn" style="margin-left: 10px; padding: 5px 15px; font-size: 12px;">로그인</button>
    </div>

    <div class="container">
        <header>
            <div class="profile-photo">
                <img src="images/grandfather.png" alt="할아버지 사진" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="profile-photo-placeholder" style="display: none;">할아버지 사진</div>
            </div>
            <h1>故 정 운 홍</h1>
            <div class="dates">1926년 7월 26일 ~ 2024년 8월 25일</div>
            <div class="quote">
                "죽으나 사나 독립적 능력으로 살았다. 하늘을 우러러 부끄러운 점이 없다. 악한 일 안하고 마음 편하게 죽으면 그것이 종교라고 생각한다."
            </div>
        </header>

        <div class="nav-tabs">
            <button class="nav-tab" onclick="showSection('life')">나의 小伝 1</button>
            <button class="nav-tab" onclick="showSection('life2')">나의 小伝 2</button>
            <button class="nav-tab" onclick="showSection('life3')">나의 小伝 3</button>
            <button class="nav-tab" onclick="showSection('life4')">나의 小伝 4</button>
            <button class="nav-tab" onclick="showSection('life5')">나의 小伝 5</button>
            <button class="nav-tab" onclick="showSection('photos')">사진 앨범</button>
            <button class="nav-tab active" onclick="showSection('memories')">추억 나누기</button>
        </div>

        <div id="memories" class="content-section active">
            <h2 class="section-title">소중한 추억들</h2>
            <div id="memoriesList">
                <!-- 기존 추억들 -->
                <div class="memory-card">
                    <div class="memory-header">
                        <div class="memory-author">큰딸 영희</div>
                        <div class="memory-date">2024년 1월 15일</div>
                    </div>
                    <div class="memory-content">
                        아버지께서 늘 새벽 5시에 일어나 마당을 쓸고 화분에 물을 주시던 모습이 생각납니다. 
                        그 성실한 모습이 저에게는 가장 큰 가르침이었습니다. 
                        특히 제가 어릴 때 다쳤을 때 등에 업고 병원까지 뛰어가시던 그 따뜻한 등이 그립습니다.
                    </div>
                </div>


            </div>
        <button id="plusBtn" class="add-memory-btn">+</button>
        </div>

        <div id="photos" class="content-section">
            <h2 class="section-title">사진 앨범</h2>
            <div class="photo-gallery">
                <div class="photo-item">
                    <div class="photo-placeholder">
                        <img src="images/family1.jpg" alt="1980년 추석 가족사진" onerror="this.style.display='none'; this.parentElement.innerHTML='가족사진 1';">
                    </div>
                    <div class="photo-caption">1980년 추석 가족사진</div>
                </div>
                <div class="photo-item">
                    <div class="photo-placeholder">
                        <img src="images/fishing.jpg" alt="손자와 함께한 낚시" onerror="this.style.display='none'; this.parentElement.innerHTML='가족사진 2';">
                    </div>
                    <div class="photo-caption">손자와 함께한 낚시 (2010년)</div>
                </div>
                <div class="photo-item">
                    <div class="photo-placeholder">
                        <img src="images/anniversary.jpg" alt="결혼 50주년 기념사진" onerror="this.style.display='none'; this.parentElement.innerHTML='가족사진 3';">
                    </div>
                    <div class="photo-caption">결혼 50주년 기념사진</div>
                </div>
                <div class="photo-item">
                    <div class="photo-placeholder">
                        <img src="images/garden.jpg" alt="텃밭에서" onerror="this.style.display='none'; this.parentElement.innerHTML='가족사진 4';">
                    </div>
                    <div class="photo-caption">텃밭에서 (2020년)</div>
                </div>
            </div>
        <button id="plusBtn1" class="add-photo-btn">+</button>

        </div>

        <div id="life" class="content-section">
            <h3 class="section-title">1. 어린 시절과 우리집 가계</h2>
            <div class="life-story">
<p>나도 남같이 자서전이나 써볼까. 그러나 글 재주도 없고 뛰어나게 잘한 일도 없이 한평생 평탄한 길을 걸어온 내가 자서전이란 것보다 여생이 얼마 안 남아 반성 겸 자손들에게 내 살아온 것을 메모 정도로 알려 볼까 한다.</p>

<p>나는 1926년 한창 무더운 장마철(7월)에 경기도 파주에서 6남 2녀 중 3남으로 태어나서 6살 무렵 경기도 이천(새실)으로 부모님을 따라 이사 농촌 생활을 했다. 그 때는 도시의 부자가 농촌 농토를 독점(지주)하고 농민들은 거의 다 자기 농토 없이 지주의 땅을 빌려(소작) 1년 내내 피땀흘려 농사지어 반 이상을 지주에게 바친다. 아버지는 이런 땅을 농촌에서 지주 대신 관리하는 일(사음)을 맡아본다. 농민들은 그것(소작)도 못 얻는다던지 하던 소작을 떼버리면 굶어 죽는 수 밖에 없어 사음 보는 아버지를 상전으로 나리라고 부른다.</p>

<p>또한 우리 땅도 많은 이천에서 몇 째 안가는 부자였다. 그래도 나는 그 곳 초등학교를 다니면서 들판에 나가 쉬지 않고 모도 내고 밭도 매고 집에서는 가마니도 짜고 새끼도 꼬고 농사꾼이었다. 가마니는 군수품으로 일제가 농가마다 책임량을 지정해서 강요했다. 초등학교 5,6학년 2년간은 약 10km 떨어진 이천읍까지 매일 자전거 통학했다.</p>

<p>초등학교 졸업 후 1년간 농사 일하고 1941년 개성경찰서 형사부장 먼 친척인 정운창씨 인연으로 개성 송도중학교에 10여대 1 이란 경쟁을 뚫고 입학했다. 그 당시는 일본식민지로 강압 정치를 받는 세계 2차대전으로 일본이 최후의 발악을 할 때다. 학교 생활이란 수업은 있는 둥 마는 둥 순전히 군대 생활이다. 우선 전투모에 국방색 군복에 배낭 메고 군화에 각반을 치는 완전히 군인과 같고 온종일 교련이나 송악산에 실전 훈련과 또는 근로 봉사로 군시설작업 박연폭포 등으로 군수품으로 쓰는 송탄을 채취하러 다녔고 학교 기숙사 생활도 일거부동 모두 군대 생활이다.</p>

<p>기숙사 공동 식당에서 강냉이 주먹밥 한 개로 배가 고파 참을 수 없어 몰래 식당에 들어가 누룽지 훔쳐 먹다 들켜 밤새도록 기합 받은 일 등 고통이 심했다. 학도병이다 지원병이다 일본군으로 강제로 끌려 간다. 그런 판에 부모님이 결혼을 하면 강제 군 입대를 면할 수 있으니 결혼하라고 방학 때 집에 가니 다음 날 결혼 날이라고 가마를 타란다. 나는 부끄러워 그냥 걸어서 처가집에 갔더니 거기서도 천막을 치고 온 동네가 잔치 분위기다. 첫날 밤을 어떻게 지냈는지 생각도 안난다. 아침에 세수를 하니 어떤 젊은 여자가 수건을 주는 데 나중에 알고 보니 바로 내 아내인 신부였다.</p>

<p>원래 우리집은 황해도 평산 드메산골에서 가난하게 살았다. 아버지는 이조 중기 좌의정까지 하던 송강 12대손으로 3남 중 첫째였는데 충북 진천에 사는 먼 친척 (해부) 현감까지 지낸 부자집으로 양자로 가서 한성사범학교를 졸업하고 곧바로 서울 수하동 보통학교 훈도(교사)와 교장을 하다가 신병으로 3년간 세브란스 병원에 입원 치료를 받고 경기 파주에서 몇 년 간 살다가 내가 6살 무렵 경기도 이천으로 지주의 사음을 맡아 보게 된 모양이다.</p>

<p>우리 조상의 봉제사 관계를 말하자면 아버지 3형제 중 아버지는 양자로 가서 양가 봉제사 하지만 두 동생이 마땅히 생가 봉제사 해야 하는데 두 분 모두 자손 없이 끝나서 그동안 내가 오랫동안 생가 봉제사 했으나 우리 형제 모두 누구 하나 아버지 제사 지낼 사람이 없다. 참으로 한심한 노릇이다. 할 수 없이 내가 몇 년 전부터 부모님 제사를 맡게 됐다. 아마도 내가 세상을 뜬 후에는 봉제사나 산소 관리하는 자손이 있을 것 같지 않고 우리 자손이 제대로 화목 유지할지가 정말 우려된다.</p>
            </div>
        </div>

        <div id="life2" class="content-section">
            <h3 class="section-title">2. 첫 사회 생활과 6.25</h2>
            <div class="life-story">
<p>결혼하고 중학교 졸업하고 8.15 해방이 된 것은 1944년 부터 1945년 사이 1년 간도 안되는 거의 동시에 일이라 할 수 있다. 이렇게 해서 나이 20의 어린 나이에 첫 사회 생활을 하게 되는데 몇 개월 간 처가집에서 동네 공회당에서 동네 애들을 모아 가르치기도 하고 서울로 와서 경성 세무서(현 중부 세무서) 근무 하는데 처조카(용환)가 대학에 가야 한다고 강요하는 바람에 할 수 없이 성균관대학 야간부에 입학했다. 그런데 우선 의식주 생활(가정)을 해야겠는데 부모님은 하나 도와주지 않고(바리지도 않았다). 내 스스로 해결하는데 그 당시 초대 서울시장(김형민)이 은사라 부탁하니 서대문 초등학교 교사로 발령 근무케 되고 집은 내 친구(이석구, 김병태) 네 방 한칸을 빌려 살게 됐다. 정말 젓가락 한짝 도움 받은 게 없이 한 개 한 개 사서 살림을 시작했다. 그 때 (21살) 벌써 용택까지 있어서 부모가 됐다. 그리 하여 낮에는 학교 근무 밤에는 야간 대학 공부하면서 지내는데 처조카(용환)가 나를 초등학교 근무 그만 두고 조선 무선 중학교(지금의 광운 전자 대학)를 근무하게 해주었다. 거의 나와 같은 나이 또래 학생을 가르치는데 정말 떨리고 겁이 나서 혼났다.</p>

<p>그리고 가정 생활이 빈곤에 허덕였다. 전세집은 생각도 못하고 고지대 수도물도 없는 월세집으로 그야말로 판자집 하꼬방집을 임대 사는데 아마도 1년에 열 번은 이사하는데 지금 같이 트럭 등으로 하는 게 아니고 리어카를 빌려 두 내외가 앞 뒤에서 끌고 간다. 그 당시는 빌릴 차도 없고 또한 살림살이 도구도 식기과 이부자리 뿐이다. 수도물도 없이 물장사한테 하루 한 지게 씩 사서 썼다. </p>

<p>이렇게 사는 데 청천벽력으로 6.25가 터졌다. 밤새도록 기관총 따발총 소리, 폭격 소리, 당장 죽을 것 같아 방 안에서 이불 속에서 꼼짝 못하고 있는데 긴 싸이렌 소리와 함께 세상이 조용하다. 날이 환해 간신히 밖에 나가보니 중앙청엔 태극기 대신 인공기가 걸리고 거리마다 인민군과 공산당원이 쏘다니며 탱크가 굉음을 내고 다니며 시신이 여기 저기 땅바닥에 널려 있다. 참으로 끔찍하고 공포의 세상이다. 정부와 군경 모두 남쪽으로 퇴각하고 다들 걸어서 피난을 한다. </p>

<p>우선 당장 먹을 것을 구할 수 없어 굶어 죽을 판이라 나는 남들과 같이 퇴계원, 노원 쪽으로 가서 호박과 감자 한 보따리 구해 와서 연명을 하면서 나는 용택(5살)을 업고 아내는 효택(2살)을 업고 그러고 당장 필요한 식기 등을 가지고 이천 처가집으로 걸어서 가는 데 가다 날이 저물면 가던 길바닥에서 밥도 해 먹고 자고 하면서 가는 데 마침 효택이는 온 몸이 새빨갛게 홍역을 하는 걸 길거리에서 비를 함빡 맞혀 업은 채로 죽은 것을 길거리 부근에 파묻고 가는 비참한 일도 겪었다. 또한 북한 의용군으로 끌려가다 도망치기도 했다. 또는 공교롭게 인민군 부대가 내 곁을 지나는 바람에 미군 비행기로부터 기총 사격을 당해 총알이 쏟아져 죽는 건데 요행이 살아 나기도 했다.</p>

<p>이럭저럭 약 1 주 정도 고생 끝에 이천 처가집에 도착해서 수 개월 간 걱정없이 평안히 지낼 수 있게 됐고 이천읍 부모님 집을 가보니 집은 텅텅 비고 반동분자 집이라고 감시해서 들어가지 못하고 되돌아왔다.  온 세상이 북조선인민공화국이 되버린 것 같더니 국군과 미군이 반격해서 남쪽에서 북상하니 인민군이 퇴각하고 9.28 수복하면서 평양까지 갔다가 중공군 참전으로 다시 1.4 후퇴하므로 나는 국민 방위군에 입대해서 순전히 걸어서 17일 만에 밀양에 도착했다. 발바닥이 터져서 피가 나고 못 먹고 못 자서 그 참상이란 말 할 수 없었다.</p>

<p>내 가족을 비롯 부모형제 모두 사방에 흩어져서 어디 가 있는지 살아 있는지 생사를 모른다. 다시 국국이 북상한다는 소식을 듣고 나는 몰래 국민 방위군에서 빠져 나와 밀양에서 북쪽으로 또 다시 걸어서 이천읍으로 와 보니 경찰서 근무인 둘째 형님을 만나 가족 소식을 대강 알아 서로 만나게 되었다.</p>
            </div>
        </div>

        <div id="life3" class="content-section">
            <h3 class="section-title">3. 직장 생활</h2>
            <div class="life-story">


<p>6.25 의 난리로 직장을 생각도 못하고 그야말로 사경을 헤매다가 우리 고향 진천으로 가서 그 당시 충북 학무국장인 친척 정인택에 부탁해서 진천농업중학교에 근무하게 되어 그 후 미원중학교, 충일중학교, 서울공업고등학교, 영등포중학교, 서울여자고등학교, 선린중학교, 강남중학교, 덕수중학교, 용산중학교, 강남여자중학교 등 계속 35년간 교편 생활을 했다. </p>

<p>이렇게 장기간 여러 학교에서 계속 근무하면서 승진 한 번 못하고 만년 교사로 끝난 것은 내가 못난 탓도 있겠지만 나이 40 전부터 폐결핵으로 휴가를 받아 제천 의림지에서 뱀도 먹고 주사(스트랩토마이신)를 지나치게 맞아 쇼크가 발생 귀가 안들리게 돼서 수업도 엉망이고 사회적으로 대화도 못하게 돼서 아예 승진의 희망도 못 갖게 돼서 할 수 없이 그 당시 공로 퇴직이란 제도가 있어서 56세에 공로 퇴직 은퇴하고 말았다. 지금 현재까지도 귀가 안 들려 한 많고 괴로운 세상을 보내고 있다. </p>

<p>내가 한 평생을 오직 교편 생활로 보냈는데 반성을 하면 참된 스승과 제자의 관계로 양심과 사랑의 정신으로 교육을 못해 지금 와서 제자들 보기가 부끄럽다. 그러나 그 당시의 학교는 요새 학교 모양으로 한 학급에 30명 그리고 TV, 에어콘, 선풍기, 실험 기구 등 시설은 꿈도 못 꾸었다. 한 학급에 80명씩 콩나물 교실 그것도 모자라 2부제, 3부제로 편성하고 시설이란 하나도 없고 말이 책걸상이지 요새 고물로도 안 쓴다. 여름에 한 번 교실 수업하면 학생이나 교사는 80명 콩나물 통에서 땀이 흠뻑 나서 찜질방이나 다름 없다. 그리고 학교 운영 경비는 모두 자급자족 학생 부담이다. 학생에게 수업료, 후원회비, 학급비 등 강제 징수 하느라 담임 선생이 학생들을 들들 볶아 짜낸다. 학생 부담금을 안 내면 벌청소, 또는 심하면 정학, 퇴학까지 시킨다. 학생부담금을 잘 걷어 들이는 교사가 유능한 교사고 승진도 빠르다. </p>

<p>이런 판국에 사제의 정을 찾아 볼 수 있을까? 월급도 제대로 안 나와 부잣집 애들을 편애해서 도움을 받는다. 이런 판에 어떻게 자기 이상에 맞는 교육을 할 수 있나. 요새 교육 공무원이 부럽다. </p>
            </div>
        </div>

        <div id="life4" class="content-section">
            <h3 class="section-title">4. 우리 집 안의 시련</h2>
            <div class="life-story">
<p>앞에서 말한 바와 같이 우리 집안은 재산도 있고 남부럽지 않게 살았는데 재산도 다 없어지고 남에게 존경도 못 받게 된 것은 어찌한 일인가?</p>

<p>2차 세계대전에 일본이 패망하자 일본의 강압 정치하의 식민지로부터 8.15 해방이 되자 일본에 대한 악감정이 폭발 친일파를 숙청하는 폭동이 일어났다. 우리집은 친일 반민족 행위를 한 적은 없지만 동네 초등학교 일인 교장과 가깝게 재니고 둘째 형님(운한)이 일제 치하 군청에 근무했다는 이유로 친일파로 낙인 찍혀 군중이 우리집으로 몰려 들어 폭행을 하니 온 가족이 일시 다른 곳으로 피해 숨어 버린 적이 있다. 아마도 우리가 지주로서 그 당시 95%이상 농민이 소작을 해서 착취를 당한 것이 원한이 된 것이 근본 원인일 것이다. 이런 일이 있은 후 더욱 가운이 기울어져 갔다. </p>

<p>그런데다가 얼마 후 6.25가 터졌다. 앞서 말한 바와 같이 아비규환의 세상이다. 이북의 인민군과 공산당이 쏟아져 들어오고 대한민국은 대통령부터 모조리 남쪽 끝으로 도망을 가버렸다. 그 당시 둘째형님(운한)이 경찰서 사찰과 형사로 간첩, 공산당 등 무수히 잡아 들여 고문을 많이해 원한을 많이 샀다. 그리고 운영, 운호도 경찰관이었다. 그 때 우리는 제일 가는 반동 분자로 숙청 대상이다. 세상이 이렇게 되니 서로 이웃끼리, 아는 사람끼리 인민군에 일러 바쳐 서로 해코지 한다. 인민 재판 등으로 많은 사람이 희생된다. 우리 집안은 잡혔다하면 살아 남지 못할 것이 뻔해 이 곳 저 곳 피난 생활을 할 수 밖에 없다. </p>

<p>갖은 고통 끝에 휴전이 되어 집으로 돌아 오니 재산은 거의 다 없어지고 사는 집 한 채 있을 줄 알았더니 그 마저 폭격을 맞아 온 데 간 데 없어지고 다행히 방 한 칸만 오뚝 남아 부모님은 거기서 살게 되었다. 그리고 8.15, 6.25 등 난리로 우리 소유 땅도 거의 다 팔아 먹고 더욱이 큰 형님과 둘째 형님이 무슨 사업을 한답시고 실패해서 무일푼의 신세가 되어버렸다. 이런 지경에 부모님을 돌 볼 사람이 없어 내가 교사 박봉에 매월 몇푼씩 부쳐 드리다가 얼마 후에 우리집(대방동)으로 모시게 되었다. </p>            
</div>
        </div>

        <div id="life5" class="content-section">
            <h3 class="section-title">5. 나의 인생관</h2>
            <div class="life-story">
<p> 아내는 한평생 낙이나 호강을 받아 보지 못하고 헐벗고 굶주림에 시달려간 불쌍하기 그지 없는 사람이다. 저세상이 있다면 거기서 남 부럽지 않은 행복한 생활을 하기 바란다. 아내가 고인이 되어 집을 떠나는 날 나는 남몰래 얼마나 울었는지 모르고 지금도 생각하면 눈물이 쏟아진다.</p> 

<p>나는 한평생 교육 생활을 하며 80 여 년이란 긴 삶을 걸어왔다. 내가 이 세상에 이거다 하는 보람 있는 일을 못했다. 그러나 한 평생 악한 일을 한 적 없다. 그리고 어디에 기대어 사는 기생충 같은 생활을 안하고 죽으나 사나 독립적 능력으로 살았다. 하늘을 우러러 부끄러운 점이 없다. 남들은 불교다, 예수교다, 종교를 믿지만 나는 안 믿는다. 악한 일만 안하고 마음 편하게 죽으면 그것이 종교라 생각한다. 그리고 또 한 사람이 죽으면 그만 이지 저 세상이 어디 있고 신이 어디 있단 말인가?</p>

<p>그래서 나 죽으면 깨끗하게 화장해서 산 중간의 나무 밑에 1m 정도 파고 백골 가루를 용기에 넣지 말고 그냥 파 묻고 봉분도 없이 표식(1m 정도)이나 하나 세워 놓고 자손들의 추모 장소로 하기 바라고 또한 제사도 꼭 지내지 않아도 된다. 
일 평생 세상에 이바지한 일도 없는 자가 죽어서까지 살아 있는 사람 괴롭혀서야 되겠나? 깨끗이 이 세상 왔다 깨끗이 살고 깨끗이 가야지.</p>

<p> 2007년 2월 5일~8일 정운홍 씀 </p>
            </div>
        </div>


        <div class="footer">
            할아버지를 영원히 기억하며 사랑합니다.
        </div>
    </div>

    <!-- 인증 모달 -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('authModal')">&times;</span>
            <h2 id="authTitle">로그인</h2>
            <form id="authForm">
                <div class="form-group">
                    <label for="email">이메일:</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">비밀번호:</label>
                    <input type="password" id="password" required>
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn" id="authSubmitBtn">로그인</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleAuthMode()">회원가입</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 추억 추가 모달 -->
    <div id="memoryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('memoryModal')">&times;</span>
            <h2>추억 나누기</h2>
            <form id="memoryForm">
                <div class="form-group">
                    <label for="authorName">작성자:</label>
                    <input type="text" id="authorName" required>
                </div>
                <div class="form-group">
                    <label for="memoryContent">추억:</label>
                    <textarea id="memoryContent" placeholder="할아버지와의 소중한 추억을 나눠주세요..." required></textarea>
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn">저장</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('memoryModal')">취소</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 사진 추가 모달 -->
    <div id="photoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('photoModal')">&times;</span>
            <h2>사진 업로드</h2>
            <form id="photoForm">
                <div class="form-group">
                    <label for="authorName">작성자:</label>
                    <input type="text" id="authorName" required>
                </div>
                <div class="form-group">
                    <label for="photoContent">설명:</label>
                    <textarea id="photoContent" placeholder="할아버지와의 소중한 추억을 나눠주세요..." required></textarea>
                </div>
                <div class="form-group">
                    <!-- 사진 업로드 추가 -->
                    <input type="file" id="photoImage" name="image" accept="image/*">
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn">저장</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('photoModal')">취소</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Cloudflare Workers API 엔드포인트 (실제 URL로 변경 필요)
        const API_BASE_URL = 'https://memorial-api.seliscos.workers.dev';
        
        let currentUser = null;
        let isSignUpMode = false;

        // 페이지 로드 시 인증 상태 확인
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            loadMemories();
        });

        function showSection(sectionId) {
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
        }

        function checkAuthStatus() {
            // 로컬 스토리지에서 토큰 확인 (실제로는 쿠키나 다른 방식 사용 권장)
            const token = localStorage.getItem('auth_token');
            const userEmail = localStorage.getItem('user_email');
            
            if (token && userEmail) {
                updateAuthUI(true, userEmail);
                currentUser = { token, email: userEmail };
            } else {
                updateAuthUI(false);
            }
        }

        function updateAuthUI(isLoggedIn, email = '') {
            const authText = document.getElementById('authText');
            const authBtn = document.getElementById('authBtn');
            
            if (isLoggedIn) {
                authText.textContent = `안녕하세요, ${email}님`;
                authBtn.textContent = '로그아웃';
                authBtn.onclick = logout;
            } else {
                authText.textContent = '로그인이 필요합니다';
                authBtn.textContent = '로그인';
                authBtn.onclick = showAuthModal;
            }
        }

        function showAuthModal() {
            document.getElementById('authModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function toggleAuthMode() {
            isSignUpMode = !isSignUpMode;
            const title = document.getElementById('authTitle');
            const submitBtn = document.getElementById('authSubmitBtn');
            
            if (isSignUpMode) {
                title.textContent = '회원가입';
                submitBtn.textContent = '회원가입';
            } else {
                title.textContent = '로그인';
                submitBtn.textContent = '로그인';
            }
        }

        // 인증 폼 처리
        document.getElementById('authForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const submitBtn = document.getElementById('authSubmitBtn');
            
            submitBtn.disabled = true;
            submitBtn.textContent = '처리중...';
            
            try {
                if (isSignUpMode) {
                    await signUp(email, password);
                } else {
                    await signIn(email, password);
                }
            } catch (error) {
                alert('오류가 발생했습니다: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = isSignUpMode ? '회원가입' : '로그인';
            }
        });

        // 회원가입
        async function signUp(email, password) {
            const response = await fetch(`${API_BASE_URL}/signup`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error || '회원가입에 실패했습니다.');
            }
            
            alert(data.message || '이메일 인증 링크가 발송되었습니다.');
            closeModal('authModal');
            toggleAuthMode(); // 다시 로그인 모드로 변경
        }

        // 로그인 (Cloudflare Workers를 통해 Supabase와 통신)
        async function signIn(email, password) {
            const response = await fetch(`${API_BASE_URL}/signin`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error || '로그인에 실패했습니다.');
            }
            
            // 토큰 저장
            localStorage.setItem('auth_token', data.access_token);
            localStorage.setItem('user_email', email);
            localStorage.setItem('access_token', data.access_token);

            currentUser = { token: data.access_token, email };
            updateAuthUI(true, email);
            closeModal('authModal');

            // 자동 로그아웃 시작 (추가)
            autoLogoutManager.onLoginSuccess();
            
            alert('로그인 성공!');
        }

        // 로그아웃
// 개선된 로그아웃 함수
function logout() {
    // 자동 로그아웃 정리
    if (typeof autoLogoutManager !== 'undefined') {
        autoLogoutManager.onManualLogout();
    }

    // 모든 토큰 및 사용자 데이터 삭제
    localStorage.removeItem('access_token');
    localStorage.removeItem('auth_token');
    localStorage.removeItem('user_email');
    localStorage.removeItem('user_data');
    localStorage.removeItem('login_time');

    // 전역 변수 초기화
    currentUser = null;

    // UI 업데이트
    updateAuthUI(false);

    // 페이지 새로고침
    location.reload();
    
    alert('로그아웃되었습니다.');
}

        // + 버튼 클릭 시 추억 추가 모달 표시
        document.getElementById('plusBtn').addEventListener('click', function() {
            if (!currentUser) {
                alert('추억을 나누려면 먼저 로그인해주세요.');
                showAuthModal();
                return;
            }
            document.getElementById('memoryModal').style.display = 'block';
        });

        // 추억 저장
        document.getElementById('memoryForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!currentUser) {
                alert('로그인이 필요합니다.');
                return;
            }
            
            const author = document.getElementById('authorName').value;
            const content = document.getElementById('memoryContent').value;
            const submitBtn = e.target.querySelector('button[type="submit"]');
      

            submitBtn.disabled = true;
            submitBtn.textContent = '저장 중...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/submit-memory`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentUser.token}`
                    },
                    body: JSON.stringify({ 
                        content,
                        author 
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || '추억 저장에 실패했습니다.');
                }
                
                // 새로운 추억을 화면에 추가
                addMemoryToUI(author, content, new Date(), {
                        id: data.id, // 서버에서 반환된 ID
                        email: currentUser.email
                });
                
                // 폼 초기화
                document.getElementById('memoryForm').reset();
                closeModal('memoryModal');
                
                alert('추억이 저장되었습니다.');
                
            } catch (error) {
                alert('오류가 발생했습니다: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '저장';
            }
        });

function addMemoryToUI(author, content, date, memoryData = null) {
    const memoriesList = document.getElementById('memoriesList');
    
    if (!memoriesList) {
        console.error('memoriesList 요소를 찾을 수 없습니다');
        return;
    }
    
    const memoryCard = document.createElement('div');
    memoryCard.className = 'memory-card';
    
    // memoryData가 있으면 data-memory-id 속성 추가
    if (memoryData && memoryData.id) {
        memoryCard.setAttribute('data-memory-id', memoryData.id);
    }
    
    const formattedDate = date.toLocaleDateString('ko-KR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    
    memoryCard.innerHTML = `
        <div class="memory-header">
            <div class="memory-author">${author}</div>
            <div class="memory-date">${formattedDate}</div>
        </div>
        <div class="memory-content">${content}</div>
    `;
    
    // 새로운 추억을 맨 위에 추가
    memoriesList.insertBefore(memoryCard, memoriesList.firstChild);


    // 삭제 버튼 추가 부분 (수정됨)
    if (memoryData && memoryData.id) {

        // DeleteManager 존재 확인 후 삭제 버튼 추가
        if (typeof DeleteManager !== 'undefined') {
            try {
                // 전역 API_BASE_URL 사용하거나 직접 입력
                const API_BASE_URL = window.API_BASE_URL || 'https://memorial-api.seliscos.workers.dev';
                const deleteManager = new DeleteManager(API_BASE_URL);
                deleteManager.addDeleteButtonToMemory(memoryCard, memoryData);
                console.log(`추억 ${memoryData.id}에 삭제 버튼 추가 완료`);
            } catch (error) {
                console.error('DeleteManager 인스턴스 생성 또는 삭제 버튼 추가 오류:', error);
            }
        }
        // DeleteManager가 없어도 오류 로그를 출력하지 않음 (선택적 기능이므로)
    }
}

        // 서버에서 추억 목록 불러오기
        async function loadMemories() {
            try {
                const response = await fetch(`${API_BASE_URL}/memories`);
                const data = await response.json();
                
                if (response.ok && data.memories) {
                    const memoriesList = document.getElementById('memoriesList');
                    
                    // 서버에서 가져온 추억들을 기존 추억들 뒤에 추가
                    data.memories.forEach(memory => {
                        addMemoryToUI(
                            memory.author || memory.email, 
                            memory.content, 
                            new Date(memory.created_at),
                           {
                               id: memory.id,
                               email: memory.email || memory.author_email,
                              // 필요한 다른 데이터들...
                           }
                        );
                    });
                }
            } catch (error) {
                console.error('추억 로드 실패:', error);
            }
        }

        // 모달 외부 클릭 시 닫기
        window.onclick = function(event) {
            const authModal = document.getElementById('authModal');
            const memoryModal = document.getElementById('memoryModal');
            
            if (event.target === authModal) {
                authModal.style.display = 'none';
            }
            if (event.target === memoryModal) {
                memoryModal.style.display = 'none';
            }
        }

        // + 버튼 클릭 시 사진 추가 모달 표시
        document.getElementById('plusBtn1').addEventListener('click', function() {
            if (!currentUser) {
                alert('사진을 저장하려면 먼저 로그인해주세요.');
                showAuthModal();
                return;
            }
            document.getElementById('photoModal').style.display = 'block';
        });


// 토큰 갱신 함수
async function refreshUserToken() {
    try {
        if (!currentUser || !currentUser.refresh_token) {
            throw new Error('리프레시 토큰이 없습니다');
        }

        const response = await fetch(`${API_BASE_URL}/refresh-token`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                refresh_token: currentUser.refresh_token
            })
        });

        if (!response.ok) {
            throw new Error('토큰 갱신 실패');
        }

        const data = await response.json();
        
        // 새 토큰으로 업데이트
        currentUser.token = data.access_token;
        if (data.refresh_token) {
            currentUser.refresh_token = data.refresh_token;
        }
        
        // 로컬 스토리지에도 업데이트
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        return currentUser.token;
    } catch (error) {
        console.error('토큰 갱신 오류:', error);
        // 갱신 실패 시 로그아웃 처리
        localStorage.removeItem('currentUser');
        currentUser = null;
        alert('세션이 만료되었습니다. 다시 로그인해주세요.');
        // 로그인 페이지로 리다이렉트 또는 로그인 모달 표시
        throw error;
    }
}

// 인증이 필요한 API 호출을 위한 헬퍼 함수
async function authenticatedFetch(url, options = {}) {
    try {
        // 첫 번째 시도
        let response = await fetch(url, {
            ...options,
            headers: {
                ...options.headers,
                'Authorization': `Bearer ${currentUser.token}`
            }
        });

        // 401 오류이고 리프레시 토큰이 있으면 토큰 갱신 시도
        if (response.status === 401 && currentUser?.refresh_token) {
            console.log('토큰 만료 감지, 갱신 시도');
            
            try {
                await refreshUserToken();
                
                // 갱신된 토큰으로 재시도
                response = await fetch(url, {
                    ...options,
                    headers: {
                        ...options.headers,
                        'Authorization': `Bearer ${currentUser.token}`
                    }
                });
            } catch (refreshError) {
                throw new Error('토큰 갱신 실패');
            }
        }

        return response;
    } catch (error) {
        throw error;
    }
}

// 수정된 사진 업로드 폼 이벤트 핸들러
document.getElementById('photoForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    if (!currentUser) {
        alert('로그인이 필요합니다.');
        return;
    }
    
    const author = document.getElementById('authorName').value;
    const content = document.getElementById('photoContent').value;
    const imageFile = document.getElementById('photoImage').files[0];
    
    if (!imageFile) {
        alert('사진을 선택해주세요.');
        return;
    }
    
    const submitBtn = e.target.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.textContent = '업로드 중...';
    
    try {
        // 디버깅 정보
        console.log('API_BASE_URL:', API_BASE_URL);
        console.log('Upload URL:', `${API_BASE_URL}/upload-photo`);
        console.log('Current User:', currentUser);
        
        // FormData 사용해서 파일 전송
        const formData = new FormData();
        formData.append('image', imageFile);
        formData.append('caption', content);
        formData.append('uploader_name', author);
        
        // 인증이 필요한 요청이므로 authenticatedFetch 사용
        const response = await authenticatedFetch(`${API_BASE_URL}/upload-photo`, {
            method: 'POST',
            body: formData
        });
        
        console.log('Response status:', response.status);
        console.log('Response headers:', [...response.headers.entries()]);
        
        // 응답이 JSON인지 확인
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
            const textResponse = await response.text();
            console.error('Non-JSON response:', textResponse);
            throw new Error(`서버 응답이 JSON이 아닙니다: ${textResponse}`);
        }
        
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.error || '사진 저장에 실패했습니다.');
        }
        
        // UI에 새 사진 추가
        addPhotoToUI(data.photo, {
                        id: data.id, // 서버에서 반환된 ID
                        email: currentUser.email
                });
        
        document.getElementById('photoForm').reset();
        closeModal('photoModal');
        alert('사진이 성공적으로 업로드되었습니다.');
        
    } catch (error) {
        console.error('사진 업로드 오류:', error);
        alert('오류가 발생했습니다: ' + error.message);
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = '저장';
    }
});

// UI에 사진 추가하는 함수
function addPhotoToUI(photo, photoData = null) {
    const photoList = document.querySelector('.photo-gallery');

    
    if (!photoList) {
        console.error('사진 갤러리 컨테이너(.photo-gallery)를 찾을 수 없습니다');
        return;
    }
    
    const photoCard = document.createElement('div');
    photoCard.className = 'photo-item';
    photoCard.setAttribute('data-photo-id', photo.id);
    
    const formattedDate = new Date(photo.created_at).toLocaleDateString('ko-KR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    
    photoCard.innerHTML = `
        <div class="photo-container">
            <div class="photo-loading">사진 로딩 중...</div>
        </div>
        <div class="photo-header">
            <div class="photo-author">${photo.uploader_name}</div>
            <div class="photo-date">${formattedDate}</div>
        </div>
        ${photo.caption ? `<div class="photo-content">${photo.caption}</div>` : ''}
    `;
    
    // 사진 목록 맨 위에 추가
    photoList.insertBefore(photoCard, photoList.firstChild);

    // 이미지 로딩 (실제 URL이 있는 경우)
    if (photo.image_url) {
        const img = new Image();
        img.onload = function() {
            const container = photoCard.querySelector('.photo-container');
            container.innerHTML = `
                <img src="${photo.image_url}" 
                     alt="${photo.caption || '추억 사진'}" 
                     class="photo-image"
                     onclick="openPhotoModal('${photo.id}')">
            `;
        };
        img.onerror = function() {
            const container = photoCard.querySelector('.photo-container');
            container.innerHTML = '<div class="photo-error">사진을 불러올 수 없습니다</div>';
        };
        img.src = photo.image_url;
    }

if (photoData && photoData.id) {

        // DeleteManager 존재 확인 후 삭제 버튼 추가
    if (typeof DeleteManager !== 'undefined') {
        try {
 const API_BASE_URL = window.API_BASE_URL || 'https://memorial-api.seliscos.workers.dev';

            const deleteManager = new DeleteManager(API_BASE_URL);
            deleteManager.addDeleteButtonToPhoto(photoCard, photoData);
            console.log(`사진 ${photo.id}에 삭제 버튼 추가 완료`);
        } catch (error) {
            console.error('삭제 버튼 추가 오류:', error);
        }
  
     }
 }
}
// 모든 사진 로드하는 함수
async function loadAllPhotos() {
    try {
        const response = await fetch(`${API_BASE_URL}/photos`);
        
        if (!response.ok) {
            throw new Error('사진 목록을 가져올 수 없습니다');
        }
        
        const result = await response.json();
        const photos = result.photos;
        
        const photoList = document.querySelector('.photo-gallery');
        
        if (!photoList) {
            console.error('사진 갤러리 컨테이너(.photo-gallery)를 찾을 수 없습니다');
            return;
        }
        
        // 기존 사진들 제거 (중복 방지)
        photoList.innerHTML = '';
        
        // 사진들을 UI에 추가
        photos.forEach(photo => {
            addPhotoToUI(photo,                            {
                               id: photo.id,
                               email: photo.email || photo.author_email
                           }
);
        });
        
        console.log(`${photos.length}개의 사진을 로드했습니다.`);
        
    } catch (error) {
        console.error('사진 목록 로딩 오류:', error);
        alert('사진을 불러오는 중 오류가 발생했습니다: ' + error.message);
    }
}

// 사진 상세보기 모달 열기 함수
async function openPhotoModal(photoId) {
    try {
        const response = await fetch(`${API_BASE_URL}/photos/${photoId}`);
        
        if (!response.ok) {
            throw new Error('사진을 불러올 수 없습니다');
        }
        
        const result = await response.json();
        const photo = result.photo;
        
        // 모달 HTML 생성 및 표시
        const modalHtml = `
            <div id="photoViewModal" class="modal">
                <div class="modal-content photo-modal-content">
                    <span class="close" onclick="closeModal('photoViewModal')">&times;</span>
                    <div class="photo-view-container">
                        <img src="${photo.image_url}" alt="${photo.caption || '사진'}" class="photo-view-image">
                        <div class="photo-view-info">
                            <h3>${photo.uploader_name}</h3>
                            <p class="photo-view-date">${new Date(photo.created_at).toLocaleDateString('ko-KR')}</p>
                            ${photo.caption ? `<p class="photo-view-caption">${photo.caption}</p>` : ''}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // 기존 모달 제거 후 새 모달 추가
        const existingModal = document.getElementById('photoViewModal');
        if (existingModal) {
            existingModal.remove();
        }
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        document.getElementById('photoViewModal').style.display = 'block';
        
    } catch (error) {
        console.error('사진 상세보기 오류:', error);
        alert('사진을 불러올 수 없습니다: ' + error.message);
    }
}

// 사진 삭제 함수 (옵션)
async function deletePhoto(photoId) {
    if (!confirm('정말로 이 사진을 삭제하시겠습니까?')) {
        return;
    }
    
    try {
        const response = await fetch(`${API_BASE_URL}/photos/${photoId}`, {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${currentUser.token}`
            }
        });
        
        if (!response.ok) {
            const data = await response.json();
            throw new Error(data.error || '사진 삭제에 실패했습니다');
        }
        
        // UI에서 사진 제거
        const photoElement = document.querySelector(`[data-photo-id="${photoId}"]`);
        if (photoElement) {
            photoElement.remove();
        }
        
        alert('사진이 삭제되었습니다.');
        
    } catch (error) {
        console.error('사진 삭제 오류:', error);
        alert('사진 삭제 중 오류가 발생했습니다: ' + error.message);
    }
}

// 페이지 로드 시 사진들 불러오기
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        console.log('사진 로딩 시작...');
        
        const photoGallery = document.querySelector('.photo-gallery');
        console.log('photo-gallery 요소:', photoGallery);
        
        if (photoGallery) {
            loadAllPhotos();
        } else {
            console.error('.photo-gallery 요소를 찾을 수 없습니다. HTML 구조를 확인해주세요.');
        }
    }, 1000);
});

// CSS 스타일 추가
const photoStyles = `
<style>
.photo-item {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    overflow: hidden;
    max-width: 500px; /* 최대 너비 제한 */
    margin-left: auto;
    margin-right: auto;
}

.photo-container {
    width: 100%;
    height: 300px; /* 고정 높이로 일관성 유지 */
    overflow: hidden;
    background-color: #f5f5f5;
    position: relative;
}

.photo-image {
    width: 100%;
    height: 100%;
    object-fit: cover; /* 비율 유지하면서 영역에 맞춤 */
    cursor: pointer;
    transition: transform 0.3s ease;
    display: block;
}

.photo-image:hover {
    transform: scale(1.02);
}

.photo-header {
    padding: 12px 16px 8px;
    border-bottom: 1px solid #eee;
}

.photo-author {
    font-weight: 600;
    color: #333;
    font-size: 14px;
}

.photo-date {
    color: #666;
    font-size: 12px;
    margin-top: 2px;
}

.photo-content {
    padding: 12px 16px;
    line-height: 1.5;
    color: #444;
}

.photo-error {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #999;
    font-size: 14px;
    background-color: #f8f8f8;
}

.photo-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #666;
    font-size: 14px;
    background-color: #f0f0f0;
}

/* 모달 스타일 */
.photo-modal-content {
    max-width: 90vw;
    max-height: 90vh;
    padding: 20px;
}

.photo-view-container {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.photo-view-image {
    max-width: 100%;
    max-height: 70vh;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.photo-view-info {
    margin-top: 20px;
    text-align: center;
    max-width: 500px;
}

.photo-view-info h3 {
    margin: 0 0 8px 0;
    color: #333;
}

.photo-view-date {
    color: #666;
    font-size: 14px;
    margin-bottom: 12px;
}

.photo-view-caption {
    margin: 0;
    font-style: italic;
    color: #555;
    line-height: 1.6;
}

/* 모바일 반응형 */
@media (max-width: 768px) {
    .photo-item {
        margin: 0 10px 15px;
        max-width: none;
    }
    
    .photo-container {
        height: 250px;
    }
    
    .photo-modal-content {
        margin: 20px;
        max-width: calc(100vw - 40px);
    }
    
    .photo-view-image {
        max-height: 60vh;
    }
}

@media (max-width: 480px) {
    .photo-container {
        height: 200px;
    }
    
    .photo-view-image {
        max-height: 50vh;
    }
}
</style>
`;

// 스타일을 head에 추가
if (!document.querySelector('#photo-styles')) {
    const styleElement = document.createElement('style');
    styleElement.id = 'photo-styles';
    styleElement.innerHTML = photoStyles.replace(/<\/?style>/g, '');
    document.head.appendChild(styleElement);
}




</script>
<script src="./auto-logout.js"></script>
<script src="./delete-functionality.js"></script>
<script>
console.log('JavaScript 파일이 로드되었습니다');
    // 삭제 기능 초기화
    document.addEventListener('DOMContentLoaded', function() {
        const deleteManager = integrateDeleteFunctionality('https://memorial-api.seliscos.workers.dev');
    });
</script>
</body>
</html>