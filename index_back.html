<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í• ì•„ë²„ì§€ë¥¼ ê·¸ë¦¬ë©°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 50px;
            padding: 40px 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .profile-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 5px solid #ddd;
            margin: 0 auto 20px;
            background: #f0f0f0;
            overflow: hidden;
        }

        .profile-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-photo-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #666;
            background: #f0f0f0;
        }

        h1 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .dates {
            font-size: 1.2em;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .quote {
            font-style: italic;
            font-size: 1.1em;
            color: #34495e;
            max-width: 600px;
            margin: 0 auto;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: white;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-tab {
            padding: 12px 30px;
            margin: 0 5px;
            background: #ecf0f1;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: #3498db;
            color: white;
        }

        .nav-tab:hover {
            background: #2980b9;
            color: white;
        }

        .content-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .memory-card {
            background: #f8f9fa;
            padding: 25px;
            margin-bottom: 25px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .memory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .memory-author {
            font-weight: bold;
            color: #2c3e50;
        }

        .memory-date {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .memory-content {
            line-height: 1.8;
            color: #34495e;
        }

        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .photo-item {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .photo-item:hover {
            transform: translateY(-5px);
        }

        .photo-placeholder {
            width: 100%;
            height: 200px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 14px;
        }

        .photo-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-caption {
            padding: 15px;
            font-size: 0.9em;
            color: #555;
        }

        .life-story {
            columns: 2;
            column-gap: 30px;
            text-align: justify;
        }

        .life-story p {
            margin-bottom: 15px;
            break-inside: avoid;
        }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #3498db;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            padding-left: 30px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 5px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3498db;
        }

        .timeline-year {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .timeline-content {
            margin-top: 5px;
            color: #34495e;
        }

        .add-memory-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .add-memory-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .add-photo-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .add-photo-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }


        .footer {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
            font-style: italic;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 15px;
            right: 20px;
        }

        .close:hover {
            color: black;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
        }

        .form-group textarea {
            height: 120px;
            resize: vertical;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            margin-right: 10px;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .auth-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-size: 14px;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                margin: 5px 0;
            }
            
            .life-story {
                columns: 1;
            }
            
            .photo-gallery {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
        }
    </style>
</head>
<body>
    <div class="auth-status" id="authStatus">
        <span id="authText">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</span>
        <button onclick="showAuthModal()" id="authBtn" class="btn" style="margin-left: 10px; padding: 5px 15px; font-size: 12px;">ë¡œê·¸ì¸</button>
    </div>

    <div class="container">
        <header>
            <div class="profile-photo">
                <img src="images/grandfather.png" alt="í• ì•„ë²„ì§€ ì‚¬ì§„" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="profile-photo-placeholder" style="display: none;">í• ì•„ë²„ì§€ ì‚¬ì§„</div>
            </div>
            <h1>í• ì•„ë²„ì§€ë¥¼ ê·¸ë¦¬ë©°</h1>
            <div class="dates">1926ë…„ 7ì›” 26ì¼ ~ 2024ë…„ 8ì›” 25ì¼</div>
            <div class="quote">
                "ì£½ìœ¼ë‚˜ ì‚¬ë‚˜ ë…ë¦½ì  ëŠ¥ë ¥ìœ¼ë¡œ ì‚´ì•˜ë‹¤. í•˜ëŠ˜ì„ ìš°ëŸ¬ëŸ¬ ë¶€ë„ëŸ¬ìš´ ì ì´ ì—†ë‹¤. ì•…í•œ ì¼ ì•ˆí•˜ê³  ë§ˆìŒ í¸í•˜ê²Œ ì£½ìœ¼ë©´ ê·¸ê²ƒì´ ì¢…êµë¼ê³  ìƒê°í•œë‹¤."
            </div>
        </header>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('memories')">ì¶”ì–µ ë‚˜ëˆ„ê¸°</button>
            <button class="nav-tab" onclick="showSection('photos')">ì‚¬ì§„ ì•¨ë²”</button>
            <button class="nav-tab" onclick="showSection('life')">ìƒì•  ì´ì•¼ê¸°</button>
            <button class="nav-tab" onclick="showSection('timeline')">ì—°ëŒ€ê¸°</button>
        </div>

        <div id="memories" class="content-section active">
            <h2 class="section-title">ì†Œì¤‘í•œ ì¶”ì–µë“¤</h2>
            <div id="memoriesList">
                <!-- ê¸°ì¡´ ì¶”ì–µë“¤ -->
                <div class="memory-card">
                    <div class="memory-header">
                        <div class="memory-author">í°ë”¸ ì˜í¬</div>
                        <div class="memory-date">2024ë…„ 1ì›” 15ì¼</div>
                    </div>
                    <div class="memory-content">
                        ì•„ë²„ì§€ê»˜ì„œ ëŠ˜ ìƒˆë²½ 5ì‹œì— ì¼ì–´ë‚˜ ë§ˆë‹¹ì„ ì“¸ê³  í™”ë¶„ì— ë¬¼ì„ ì£¼ì‹œë˜ ëª¨ìŠµì´ ìƒê°ë‚©ë‹ˆë‹¤. 
                        ê·¸ ì„±ì‹¤í•œ ëª¨ìŠµì´ ì €ì—ê²ŒëŠ” ê°€ì¥ í° ê°€ë¥´ì¹¨ì´ì—ˆìŠµë‹ˆë‹¤. 
                        íŠ¹íˆ ì œê°€ ì–´ë¦´ ë•Œ ë‹¤ì³¤ì„ ë•Œ ë“±ì— ì—…ê³  ë³‘ì›ê¹Œì§€ ë›°ì–´ê°€ì‹œë˜ ê·¸ ë”°ëœ»í•œ ë“±ì´ ê·¸ë¦½ìŠµë‹ˆë‹¤.
                    </div>
                </div>


            </div>
        <button id="plusBtn" class="add-memory-btn">+</button>
        </div>

        <div id="photos" class="content-section">
            <h2 class="section-title">ì‚¬ì§„ ì•¨ë²”</h2>
            <div class="photo-gallery">
                <div class="photo-item">
                    <div class="photo-placeholder">
                        <img src="images/family1.jpg" alt="1980ë…„ ì¶”ì„ ê°€ì¡±ì‚¬ì§„" onerror="this.style.display='none'; this.parentElement.innerHTML='ê°€ì¡±ì‚¬ì§„ 1';">
                    </div>
                    <div class="photo-caption">1980ë…„ ì¶”ì„ ê°€ì¡±ì‚¬ì§„</div>
                </div>
                <div class="photo-item">
                    <div class="photo-placeholder">
                        <img src="images/fishing.jpg" alt="ì†ìì™€ í•¨ê»˜í•œ ë‚šì‹œ" onerror="this.style.display='none'; this.parentElement.innerHTML='ê°€ì¡±ì‚¬ì§„ 2';">
                    </div>
                    <div class="photo-caption">ì†ìì™€ í•¨ê»˜í•œ ë‚šì‹œ (2010ë…„)</div>
                </div>
                <div class="photo-item">
                    <div class="photo-placeholder">
                        <img src="images/anniversary.jpg" alt="ê²°í˜¼ 50ì£¼ë…„ ê¸°ë…ì‚¬ì§„" onerror="this.style.display='none'; this.parentElement.innerHTML='ê°€ì¡±ì‚¬ì§„ 3';">
                    </div>
                    <div class="photo-caption">ê²°í˜¼ 50ì£¼ë…„ ê¸°ë…ì‚¬ì§„</div>
                </div>
                <div class="photo-item">
                    <div class="photo-placeholder">
                        <img src="images/garden.jpg" alt="í…ƒë°­ì—ì„œ" onerror="this.style.display='none'; this.parentElement.innerHTML='ê°€ì¡±ì‚¬ì§„ 4';">
                    </div>
                    <div class="photo-caption">í…ƒë°­ì—ì„œ (2020ë…„)</div>
                </div>
            </div>
        <button id="plusBtn1" class="add-photo-btn">+</button>

        </div>

        <div id="life" class="content-section">
            <h2 class="section-title">ìƒì•  ì´ì•¼ê¸°</h2>
            <div class="life-story">
                <p>í• ì•„ë²„ì§€ëŠ” 1930ë…„ ê²½ìƒë¶ë„ ì•ˆë™ì—ì„œ íƒœì–´ë‚˜ì…¨ìŠµë‹ˆë‹¤. ì–´ë ¤ìš´ ì‹œì ˆì„ ë³´ë‚´ì‹œë©´ì„œë„ í•­ìƒ ê¸ì •ì ì¸ ë§ˆìŒê°€ì§ìœ¼ë¡œ ê°€ì¡±ì„ ëŒë³´ì…¨ìŠµë‹ˆë‹¤.</p>
                
                <p>ì Šì€ ì‹œì ˆ ì„œìš¸ë¡œ ìƒê²½í•˜ì—¬ ì‘ì€ ê³µì¥ì—ì„œ ì¼í•˜ì‹œë©° ê°€ì¡±ì˜ ìƒê³„ë¥¼ ì±…ì„ì§€ì…¨ìŠµë‹ˆë‹¤. ê·¸ í›„ ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ì—¬ ìê·¸ë§ˆí•œ ì‚¬ì—…ì„ ì‹œì‘í•˜ì…¨ê³ , ì„±ì‹¤í•¨ê³¼ ì •ì§í•¨ìœ¼ë¡œ ë§ì€ ì‚¬ëŒë“¤ì˜ ì‹ ë¢°ë¥¼ ë°›ìœ¼ì…¨ìŠµë‹ˆë‹¤.</p>
                
                <p>1955ë…„ í• ë¨¸ë‹ˆì™€ ê²°í˜¼í•˜ì‹  í›„ ìŠ¬í•˜ì— 2ë‚¨ 1ë…€ë¥¼ ë‘ì…¨ìŠµë‹ˆë‹¤. ìë…€ë“¤ì˜ êµìœ¡ì— ë‚¨ë‹¤ë¥¸ ê´€ì‹¬ì„ ë³´ì´ì…¨ê³ , ì–´ë–¤ ì–´ë ¤ì›€ì´ ìˆì–´ë„ ê³µë¶€í•  ìˆ˜ ìˆë„ë¡ ë’·ë°›ì¹¨í•´ ì£¼ì…¨ìŠµë‹ˆë‹¤.</p>
                
                <p>ì€í‡´ í›„ì—ëŠ” ì‘ì€ í…ƒë°­ì„ ê°€ê¾¸ì‹œë©° ì—¬ìœ ë¡œìš´ ë…¸í›„ë¥¼ ë³´ë‚´ì…¨ìŠµë‹ˆë‹¤. ë™ë„¤ ì–´ë¥´ì‹ ë“¤ê³¼ í•¨ê»˜ ê²Œì´íŠ¸ë³¼ì„ ì¦ê¸°ì‹œê³ , ì†ì ì†ë…€ë“¤ê³¼ ì‹œê°„ì„ ë³´ë‚´ëŠ” ê²ƒì„ ê°€ì¥ ì¢‹ì•„í•˜ì…¨ìŠµë‹ˆë‹¤.</p>
                
                <p>í‰ìƒì„ ë‚¨ì„ ìœ„í•´ ì‚´ì•„ì˜¤ì‹  í• ì•„ë²„ì§€ëŠ” 2024ë…„ 12ì›” 31ì¼, ê°€ì¡±ë“¤ì´ ì§€ì¼œë³´ëŠ” ê°€ìš´ë° í¸ì•ˆíˆ ì˜ë©´ì— ë“œì…¨ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>

        <div id="timeline" class="content-section">
            <h2 class="section-title">ì¸ìƒ ì—°ëŒ€ê¸°</h2>
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-year">1930ë…„</div>
                    <div class="timeline-content">ê²½ìƒë¶ë„ ì•ˆë™ì—ì„œ ì¶œìƒ</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">1948ë…„</div>
                    <div class="timeline-content">ì„œìš¸ ìƒê²½, ê³µì¥ ì·¨ì—…</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">1955ë…„</div>
                    <div class="timeline-content">í• ë¨¸ë‹ˆì™€ ê²°í˜¼</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">1956ë…„</div>
                    <div class="timeline-content">ì¥ë‚¨ ì² ìˆ˜ ì¶œìƒ</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">1958ë…„</div>
                    <div class="timeline-content">ì¥ë…€ ì˜í¬ ì¶œìƒ</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">1960ë…„</div>
                    <div class="timeline-content">ì°¨ë‚¨ ìˆ˜í˜„ ì¶œìƒ</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">1965ë…„</div>
                    <div class="timeline-content">ê°œì¸ ì‚¬ì—… ì‹œì‘</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">1985ë…„</div>
                    <div class="timeline-content">ì²« ì†ì ë¯¼ìˆ˜ ì¶œìƒ</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">1995ë…„</div>
                    <div class="timeline-content">ì‚¬ì—… ì€í‡´</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">2005ë…„</div>
                    <div class="timeline-content">ê²°í˜¼ 50ì£¼ë…„ ê¸ˆí˜¼ì‹</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">2024ë…„</div>
                    <div class="timeline-content">í–¥ë…„ 94ì„¸ë¡œ ë³„ì„¸</div>
                </div>
            </div>
        </div>



        <div class="footer">
            í• ì•„ë²„ì§€ë¥¼ ì˜ì›íˆ ê¸°ì–µí•˜ë©° ì‚¬ë‘í•©ë‹ˆë‹¤.
        </div>
    </div>

    <!-- ì¸ì¦ ëª¨ë‹¬ -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('authModal')">&times;</span>
            <h2 id="authTitle">ë¡œê·¸ì¸</h2>
            <form id="authForm">
                <div class="form-group">
                    <label for="email">ì´ë©”ì¼:</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">ë¹„ë°€ë²ˆí˜¸:</label>
                    <input type="password" id="password" required>
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn" id="authSubmitBtn">ë¡œê·¸ì¸</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleAuthMode()">íšŒì›ê°€ì…</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì¶”ì–µ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="memoryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('memoryModal')">&times;</span>
            <h2>ì¶”ì–µ ë‚˜ëˆ„ê¸°</h2>
            <form id="memoryForm">
                <div class="form-group">
                    <label for="authorName">ì‘ì„±ì:</label>
                    <input type="text" id="authorName" required>
                </div>
                <div class="form-group">
                    <label for="memoryContent">ì¶”ì–µ:</label>
                    <textarea id="memoryContent" placeholder="í• ì•„ë²„ì§€ì™€ì˜ ì†Œì¤‘í•œ ì¶”ì–µì„ ë‚˜ëˆ ì£¼ì„¸ìš”..." required></textarea>
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn">ì €ì¥</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('memoryModal')">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì‚¬ì§„ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="photoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('photoModal')">&times;</span>
            <h2>ì‚¬ì§„ ì—…ë¡œë“œ</h2>
            <form id="photoForm">
                <div class="form-group">
                    <label for="authorName">ì‘ì„±ì:</label>
                    <input type="text" id="authorName" required>
                </div>
                <div class="form-group">
                    <label for="photoContent">ì„¤ëª…:</label>
                    <textarea id="photoContent" placeholder="í• ì•„ë²„ì§€ì™€ì˜ ì†Œì¤‘í•œ ì¶”ì–µì„ ë‚˜ëˆ ì£¼ì„¸ìš”..." required></textarea>
                </div>
                <div class="form-group">
                    <!-- ì‚¬ì§„ ì—…ë¡œë“œ ì¶”ê°€ -->
                    <input type="file" id="photoImage" name="image" accept="image/*">
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn">ì €ì¥</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('photoModal')">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Cloudflare Workers API ì—”ë“œí¬ì¸íŠ¸ (ì‹¤ì œ URLë¡œ ë³€ê²½ í•„ìš”)
        const API_BASE_URL = 'https://memorial-api.seliscos.workers.dev';
        
        let currentUser = null;
        let isSignUpMode = false;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ ìƒíƒœ í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            loadMemories();
        });

        function showSection(sectionId) {
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
        }

        function checkAuthStatus() {
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í† í° í™•ì¸ (ì‹¤ì œë¡œëŠ” ì¿ í‚¤ë‚˜ ë‹¤ë¥¸ ë°©ì‹ ì‚¬ìš© ê¶Œì¥)
            const token = localStorage.getItem('auth_token');
            const userEmail = localStorage.getItem('user_email');
            
            if (token && userEmail) {
                updateAuthUI(true, userEmail);
                currentUser = { token, email: userEmail };
            } else {
                updateAuthUI(false);
            }
        }

        function updateAuthUI(isLoggedIn, email = '') {
            const authText = document.getElementById('authText');
            const authBtn = document.getElementById('authBtn');
            
            if (isLoggedIn) {
                authText.textContent = `ì•ˆë…•í•˜ì„¸ìš”, ${email}ë‹˜`;
                authBtn.textContent = 'ë¡œê·¸ì•„ì›ƒ';
                authBtn.onclick = logout;
            } else {
                authText.textContent = 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤';
                authBtn.textContent = 'ë¡œê·¸ì¸';
                authBtn.onclick = showAuthModal;
            }
        }

        function showAuthModal() {
            document.getElementById('authModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function toggleAuthMode() {
            isSignUpMode = !isSignUpMode;
            const title = document.getElementById('authTitle');
            const submitBtn = document.getElementById('authSubmitBtn');
            
            if (isSignUpMode) {
                title.textContent = 'íšŒì›ê°€ì…';
                submitBtn.textContent = 'íšŒì›ê°€ì…';
            } else {
                title.textContent = 'ë¡œê·¸ì¸';
                submitBtn.textContent = 'ë¡œê·¸ì¸';
            }
        }

        // ì¸ì¦ í¼ ì²˜ë¦¬
        document.getElementById('authForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const submitBtn = document.getElementById('authSubmitBtn');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'ì²˜ë¦¬ì¤‘...';
            
            try {
                if (isSignUpMode) {
                    await signUp(email, password);
                } else {
                    await signIn(email, password);
                }
            } catch (error) {
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = isSignUpMode ? 'íšŒì›ê°€ì…' : 'ë¡œê·¸ì¸';
            }
        });

        // íšŒì›ê°€ì…
        async function signUp(email, password) {
            const response = await fetch(`${API_BASE_URL}/signup`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            
            alert(data.message || 'ì´ë©”ì¼ ì¸ì¦ ë§í¬ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            closeModal('authModal');
            toggleAuthMode(); // ë‹¤ì‹œ ë¡œê·¸ì¸ ëª¨ë“œë¡œ ë³€ê²½
        }

        // ë¡œê·¸ì¸ (Cloudflare Workersë¥¼ í†µí•´ Supabaseì™€ í†µì‹ )
        async function signIn(email, password) {
            const response = await fetch(`${API_BASE_URL}/signin`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            
            // í† í° ì €ì¥
            localStorage.setItem('auth_token', data.access_token);
            localStorage.setItem('user_email', email);
            localStorage.setItem('access_token', data.access_token);

            currentUser = { token: data.access_token, email };
            updateAuthUI(true, email);
            closeModal('authModal');

            // ìë™ ë¡œê·¸ì•„ì›ƒ ì‹œì‘ (ì¶”ê°€)
            autoLogoutManager.onLoginSuccess();
            
            alert('ë¡œê·¸ì¸ ì„±ê³µ!');
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {

            // ìë™ ë¡œê·¸ì•„ì›ƒ ì •ë¦¬ (ì¶”ê°€)
            autoLogoutManager.onManualLogout();
    
            // ê¸°ì¡´ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
            localStorage.removeItem('access_token');
            location.reload();


            localStorage.removeItem('auth_token');
            localStorage.removeItem('user_email');
            currentUser = null;
            updateAuthUI(false);
            alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // + ë²„íŠ¼ í´ë¦­ ì‹œ ì¶”ì–µ ì¶”ê°€ ëª¨ë‹¬ í‘œì‹œ
        document.getElementById('plusBtn').addEventListener('click', function() {
            if (!currentUser) {
                alert('ì¶”ì–µì„ ë‚˜ëˆ„ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                showAuthModal();
                return;
            }
            document.getElementById('memoryModal').style.display = 'block';
        });

        // ì¶”ì–µ ì €ì¥
        document.getElementById('memoryForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!currentUser) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            
            const author = document.getElementById('authorName').value;
            const content = document.getElementById('memoryContent').value;
            const submitBtn = e.target.querySelector('button[type="submit"]');
      

            submitBtn.disabled = true;
            submitBtn.textContent = 'ì €ì¥ ì¤‘...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/submit-memory`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentUser.token}`
                    },
                    body: JSON.stringify({ 
                        content,
                        author 
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'ì¶”ì–µ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                // ìƒˆë¡œìš´ ì¶”ì–µì„ í™”ë©´ì— ì¶”ê°€
                addMemoryToUI(author, content, new Date(), {
                        id: data.id, // ì„œë²„ì—ì„œ ë°˜í™˜ëœ ID
                        email: currentUser.email
                });
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('memoryForm').reset();
                closeModal('memoryModal');
                
                alert('ì¶”ì–µì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'ì €ì¥';
            }
        });

function addMemoryToUI(author, content, date, memoryData = null) {
    const memoriesList = document.getElementById('memoriesList');
    
    if (!memoriesList) {
        console.error('memoriesList ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        return;
    }
    
    const memoryCard = document.createElement('div');
    memoryCard.className = 'memory-card';
    
    // memoryDataê°€ ìˆìœ¼ë©´ data-memory-id ì†ì„± ì¶”ê°€
    if (memoryData && memoryData.id) {
        memoryCard.setAttribute('data-memory-id', memoryData.id);
    }
    
    const formattedDate = date.toLocaleDateString('ko-KR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    
    memoryCard.innerHTML = `
        <div class="memory-header">
            <div class="memory-author">${author}</div>
            <div class="memory-date">${formattedDate}</div>
        </div>
        <div class="memory-content">${content}</div>
    `;
    
    // ìƒˆë¡œìš´ ì¶”ì–µì„ ë§¨ ìœ„ì— ì¶”ê°€
    memoriesList.insertBefore(memoryCard, memoriesList.firstChild);


    // ì‚­ì œ ë²„íŠ¼ ì¶”ê°€ ë¶€ë¶„ (ìˆ˜ì •ë¨)
    if (memoryData && memoryData.id) {

        // DeleteManager ì¡´ì¬ í™•ì¸ í›„ ì‚­ì œ ë²„íŠ¼ ì¶”ê°€
        if (typeof DeleteManager !== 'undefined') {
            try {
                // ì „ì—­ API_BASE_URL ì‚¬ìš©í•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥
                const API_BASE_URL = window.API_BASE_URL || 'https://memorial-api.seliscos.workers.dev';
                const deleteManager = new DeleteManager(API_BASE_URL);
                deleteManager.addDeleteButtonToMemory(memoryCard, memoryData);
                console.log(`ì¶”ì–µ ${memoryData.id}ì— ì‚­ì œ ë²„íŠ¼ ì¶”ê°€ ì™„ë£Œ`);
            } catch (error) {
                console.error('DeleteManager ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë˜ëŠ” ì‚­ì œ ë²„íŠ¼ ì¶”ê°€ ì˜¤ë¥˜:', error);
            }
        }
        // DeleteManagerê°€ ì—†ì–´ë„ ì˜¤ë¥˜ ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ì§€ ì•ŠìŒ (ì„ íƒì  ê¸°ëŠ¥ì´ë¯€ë¡œ)
    }
}

        // ì„œë²„ì—ì„œ ì¶”ì–µ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadMemories() {
            try {
                const response = await fetch(`${API_BASE_URL}/memories`);
                const data = await response.json();
                
                if (response.ok && data.memories) {
                    const memoriesList = document.getElementById('memoriesList');
                    
                    // ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ì¶”ì–µë“¤ì„ ê¸°ì¡´ ì¶”ì–µë“¤ ë’¤ì— ì¶”ê°€
                    data.memories.forEach(memory => {
                        addMemoryToUI(
                            memory.author || memory.email, 
                            memory.content, 
                            new Date(memory.created_at),
                           {
                               id: memory.id,
                               email: memory.email || memory.author_email,
                              // í•„ìš”í•œ ë‹¤ë¥¸ ë°ì´í„°ë“¤...
                           }
                        );
                    });
                }
            } catch (error) {
                console.error('ì¶”ì–µ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const authModal = document.getElementById('authModal');
            const memoryModal = document.getElementById('memoryModal');
            
            if (event.target === authModal) {
                authModal.style.display = 'none';
            }
            if (event.target === memoryModal) {
                memoryModal.style.display = 'none';
            }
        }

        // + ë²„íŠ¼ í´ë¦­ ì‹œ ì‚¬ì§„ ì¶”ê°€ ëª¨ë‹¬ í‘œì‹œ
        document.getElementById('plusBtn1').addEventListener('click', function() {
            if (!currentUser) {
                alert('ì‚¬ì§„ì„ ì €ì¥í•˜ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                showAuthModal();
                return;
            }
            document.getElementById('photoModal').style.display = 'block';
        });


// í† í° ê°±ì‹  í•¨ìˆ˜
async function refreshUserToken() {
    try {
        if (!currentUser || !currentUser.refresh_token) {
            throw new Error('ë¦¬í”„ë ˆì‹œ í† í°ì´ ì—†ìŠµë‹ˆë‹¤');
        }

        const response = await fetch(`${API_BASE_URL}/refresh-token`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                refresh_token: currentUser.refresh_token
            })
        });

        if (!response.ok) {
            throw new Error('í† í° ê°±ì‹  ì‹¤íŒ¨');
        }

        const data = await response.json();
        
        // ìƒˆ í† í°ìœ¼ë¡œ ì—…ë°ì´íŠ¸
        currentUser.token = data.access_token;
        if (data.refresh_token) {
            currentUser.refresh_token = data.refresh_token;
        }
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ë„ ì—…ë°ì´íŠ¸
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        return currentUser.token;
    } catch (error) {
        console.error('í† í° ê°±ì‹  ì˜¤ë¥˜:', error);
        // ê°±ì‹  ì‹¤íŒ¨ ì‹œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        localStorage.removeItem('currentUser');
        currentUser = null;
        alert('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
        // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë˜ëŠ” ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ
        throw error;
    }
}

// ì¸ì¦ì´ í•„ìš”í•œ API í˜¸ì¶œì„ ìœ„í•œ í—¬í¼ í•¨ìˆ˜
async function authenticatedFetch(url, options = {}) {
    try {
        // ì²« ë²ˆì§¸ ì‹œë„
        let response = await fetch(url, {
            ...options,
            headers: {
                ...options.headers,
                'Authorization': `Bearer ${currentUser.token}`
            }
        });

        // 401 ì˜¤ë¥˜ì´ê³  ë¦¬í”„ë ˆì‹œ í† í°ì´ ìˆìœ¼ë©´ í† í° ê°±ì‹  ì‹œë„
        if (response.status === 401 && currentUser?.refresh_token) {
            console.log('í† í° ë§Œë£Œ ê°ì§€, ê°±ì‹  ì‹œë„');
            
            try {
                await refreshUserToken();
                
                // ê°±ì‹ ëœ í† í°ìœ¼ë¡œ ì¬ì‹œë„
                response = await fetch(url, {
                    ...options,
                    headers: {
                        ...options.headers,
                        'Authorization': `Bearer ${currentUser.token}`
                    }
                });
            } catch (refreshError) {
                throw new Error('í† í° ê°±ì‹  ì‹¤íŒ¨');
            }
        }

        return response;
    } catch (error) {
        throw error;
    }
}

// ìˆ˜ì •ëœ ì‚¬ì§„ ì—…ë¡œë“œ í¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
document.getElementById('photoForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    if (!currentUser) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
    }
    
    const author = document.getElementById('authorName').value;
    const content = document.getElementById('photoContent').value;
    const imageFile = document.getElementById('photoImage').files[0];
    
    if (!imageFile) {
        alert('ì‚¬ì§„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    
    const submitBtn = e.target.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.textContent = 'ì—…ë¡œë“œ ì¤‘...';
    
    try {
        // ë””ë²„ê¹… ì •ë³´
        console.log('API_BASE_URL:', API_BASE_URL);
        console.log('Upload URL:', `${API_BASE_URL}/upload-photo`);
        console.log('Current User:', currentUser);
        
        // FormData ì‚¬ìš©í•´ì„œ íŒŒì¼ ì „ì†¡
        const formData = new FormData();
        formData.append('image', imageFile);
        formData.append('caption', content);
        formData.append('uploader_name', author);
        
        // ì¸ì¦ì´ í•„ìš”í•œ ìš”ì²­ì´ë¯€ë¡œ authenticatedFetch ì‚¬ìš©
        const response = await authenticatedFetch(`${API_BASE_URL}/upload-photo`, {
            method: 'POST',
            body: formData
        });
        
        console.log('Response status:', response.status);
        console.log('Response headers:', [...response.headers.entries()]);
        
        // ì‘ë‹µì´ JSONì¸ì§€ í™•ì¸
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
            const textResponse = await response.text();
            console.error('Non-JSON response:', textResponse);
            throw new Error(`ì„œë²„ ì‘ë‹µì´ JSONì´ ì•„ë‹™ë‹ˆë‹¤: ${textResponse}`);
        }
        
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.error || 'ì‚¬ì§„ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
        
        // UIì— ìƒˆ ì‚¬ì§„ ì¶”ê°€
        addPhotoToUI(data.photo, , {
                        id: data.id, // ì„œë²„ì—ì„œ ë°˜í™˜ëœ ID
                        email: currentUser.email
                });

        
        document.getElementById('photoForm').reset();
        closeModal('photoModal');
        alert('ì‚¬ì§„ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        
    } catch (error) {
        console.error('ì‚¬ì§„ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'ì €ì¥';
    }
});

// UIì— ì‚¬ì§„ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
function addPhotoToUI(photo, photoData = null) {
    const photoList = document.querySelector('.photo-gallery');

    
    if (!photoList) {
        console.error('ì‚¬ì§„ ê°¤ëŸ¬ë¦¬ ì»¨í…Œì´ë„ˆ(.photo-gallery)ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        return;
    }
    
    const photoCard = document.createElement('div');
    photoCard.className = 'photo-item';
    photoCard.setAttribute('data-photo-id', photo.id);


    // photoDataê°€ ìˆìœ¼ë©´ data-photo-id ì†ì„± ì¶”ê°€
    if (photoData && photoData.id) {
        photoCard.setAttribute('data-photo-id', photoData.id);
    }

    
    const formattedDate = new Date(photo.created_at).toLocaleDateString('ko-KR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    
    photoCard.innerHTML = `
        <div class="photo-container">
            <div class="photo-loading">ì‚¬ì§„ ë¡œë”© ì¤‘...</div>
        </div>
        <div class="photo-header">
            <div class="photo-author">${photo.uploader_name}</div>
            <div class="photo-date">${formattedDate}</div>
        </div>
        ${photo.caption ? `<div class="photo-content">${photo.caption}</div>` : ''}
    `;
    
    // ì‚¬ì§„ ëª©ë¡ ë§¨ ìœ„ì— ì¶”ê°€
    photoList.insertBefore(photoCard, photoList.firstChild);
    
    // ì´ë¯¸ì§€ ë¡œë”© (ì‹¤ì œ URLì´ ìˆëŠ” ê²½ìš°)
    if (photo.image_url) {
        const img = new Image();
        img.onload = function() {
            const container = photoCard.querySelector('.photo-container');
            container.innerHTML = `
                <img src="${photo.image_url}" 
                     alt="${photo.caption || 'ì¶”ì–µ ì‚¬ì§„'}" 
                     class="photo-image"
                     onclick="openPhotoModal('${photo.id}')">
            `;
        };
        img.onerror = function() {
            const container = photoCard.querySelector('.photo-container');
            container.innerHTML = '<div class="photo-error">ì‚¬ì§„ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
        };
        img.src = photo.image_url;
    }

// ğŸ”¹ ìˆ˜ì •ëœ ì‚­ì œ ë²„íŠ¼ ì¶”ê°€ ë¶€ë¶„
setTimeout(() => {
    const photoElement = document.querySelector(
        `[data-photo-id="${photo.id}"]`
    )?.closest(".photo-item");
    
    if (photoElement) {
        // API_BASE_URL ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜¤ê¸°
        const API_BASE_URL = window.API_BASE_URL || 
                          'https://memorial-api.seliscos.workers.dev';
// ì‹¤ì œ Worker URLë¡œ ë³€ê²½
        
        // DeleteManagerê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
        if (typeof DeleteManager === 'undefined') {
            console.error('DeleteManager í´ë˜ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. delete-functionality.js íŒŒì¼ì´ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
            return;
        }
        
        try {
            const deleteManager = new DeleteManager(API_BASE_URL);
            deleteManager.addDeleteButtonToPhoto(photoElement, photoData);
            console.log(`ì‚¬ì§„ ${photo.id}ì— ì‚­ì œ ë²„íŠ¼ ì¶”ê°€ ì™„ë£Œ`);
        } catch (error) {
            console.error('ì‚­ì œ ë²„íŠ¼ ì¶”ê°€ ì˜¤ë¥˜:', error);
        }
    } else {
        console.warn(`ì‚¬ì§„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: data-photo-id="${photo.id}"`);
    }
}, 100);
  }

// ëª¨ë“  ì‚¬ì§„ ë¡œë“œí•˜ëŠ” í•¨ìˆ˜
async function loadAllPhotos() {
    try {
        const response = await fetch(`${API_BASE_URL}/photos`);
        
        if (!response.ok) {
            throw new Error('ì‚¬ì§„ ëª©ë¡ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
        
        const result = await response.json();
        const photos = result.photos;
        
        const photoList = document.querySelector('.photo-gallery');
        
        if (!photoList) {
            console.error('ì‚¬ì§„ ê°¤ëŸ¬ë¦¬ ì»¨í…Œì´ë„ˆ(.photo-gallery)ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            return;
        }
        
        // ê¸°ì¡´ ì‚¬ì§„ë“¤ ì œê±° (ì¤‘ë³µ ë°©ì§€)
        photoList.innerHTML = '';
        
        // ì‚¬ì§„ë“¤ì„ UIì— ì¶”ê°€
        photos.forEach(photo => {
            addPhotoToUI(photo,                            {
                               id: photo.id,
                               email: photo.email || photo.author_email,
                              // í•„ìš”í•œ ë‹¤ë¥¸ ë°ì´í„°ë“¤...
                           }
);
        });
        
        console.log(`${photos.length}ê°œì˜ ì‚¬ì§„ì„ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.`);
        
    } catch (error) {
        console.error('ì‚¬ì§„ ëª©ë¡ ë¡œë”© ì˜¤ë¥˜:', error);
        alert('ì‚¬ì§„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
    }
}

// ì‚¬ì§„ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
async function openPhotoModal(photoId) {
    try {
        const response = await fetch(`${API_BASE_URL}/photos/${photoId}`);
        
        if (!response.ok) {
            throw new Error('ì‚¬ì§„ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
        
        const result = await response.json();
        const photo = result.photo;
        
        // ëª¨ë‹¬ HTML ìƒì„± ë° í‘œì‹œ
        const modalHtml = `
            <div id="photoViewModal" class="modal">
                <div class="modal-content photo-modal-content">
                    <span class="close" onclick="closeModal('photoViewModal')">&times;</span>
                    <div class="photo-view-container">
                        <img src="${photo.image_url}" alt="${photo.caption || 'ì‚¬ì§„'}" class="photo-view-image">
                        <div class="photo-view-info">
                            <h3>${photo.uploader_name || 'ìµëª…'}</h3>
                            <p class="photo-view-date">${new Date(photo.created_at).toLocaleDateString('ko-KR')}</p>
                            ${photo.caption ? `<p class="photo-view-caption">${photo.caption}</p>` : ''}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // ê¸°ì¡´ ëª¨ë‹¬ ì œê±° í›„ ìƒˆ ëª¨ë‹¬ ì¶”ê°€
        const existingModal = document.getElementById('photoViewModal');
        if (existingModal) {
            existingModal.remove();
        }
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        document.getElementById('photoViewModal').style.display = 'block';
        
    } catch (error) {
        console.error('ì‚¬ì§„ ìƒì„¸ë³´ê¸° ì˜¤ë¥˜:', error);
        alert('ì‚¬ì§„ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
    }
}

// ì‚¬ì§„ ì‚­ì œ í•¨ìˆ˜ (ì˜µì…˜)
async function deletePhoto(photoId) {
    if (!confirm('ì •ë§ë¡œ ì´ ì‚¬ì§„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
    }
    
    try {
        const response = await fetch(`${API_BASE_URL}/photos/${photoId}`, {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${currentUser.token}`
            }
        });
        
        if (!response.ok) {
            const data = await response.json();
            throw new Error(data.error || 'ì‚¬ì§„ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
        
        // UIì—ì„œ ì‚¬ì§„ ì œê±°
        const photoElement = document.querySelector(`[data-photo-id="${photoId}"]`);
        if (photoElement) {
            photoElement.remove();
        }
        
        alert('ì‚¬ì§„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        
    } catch (error) {
        console.error('ì‚¬ì§„ ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ì‚¬ì§„ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ì§„ë“¤ ë¶ˆëŸ¬ì˜¤ê¸°
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        console.log('ì‚¬ì§„ ë¡œë”© ì‹œì‘...');
        
        const photoGallery = document.querySelector('.photo-gallery');
        console.log('photo-gallery ìš”ì†Œ:', photoGallery);
        
        if (photoGallery) {
            loadAllPhotos();
        } else {
            console.error('.photo-gallery ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. HTML êµ¬ì¡°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
        }
    }, 1000);
});

// CSS ìŠ¤íƒ€ì¼ ì¶”ê°€
const photoStyles = `
<style>
.photo-item {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    overflow: hidden;
    max-width: 500px; /* ìµœëŒ€ ë„ˆë¹„ ì œí•œ */
    margin-left: auto;
    margin-right: auto;
}

.photo-container {
    width: 100%;
    height: 300px; /* ê³ ì • ë†’ì´ë¡œ ì¼ê´€ì„± ìœ ì§€ */
    overflow: hidden;
    background-color: #f5f5f5;
    position: relative;
}

.photo-image {
    width: 100%;
    height: 100%;
    object-fit: cover; /* ë¹„ìœ¨ ìœ ì§€í•˜ë©´ì„œ ì˜ì—­ì— ë§ì¶¤ */
    cursor: pointer;
    transition: transform 0.3s ease;
    display: block;
}

.photo-image:hover {
    transform: scale(1.02);
}

.photo-header {
    padding: 12px 16px 8px;
    border-bottom: 1px solid #eee;
}

.photo-author {
    font-weight: 600;
    color: #333;
    font-size: 14px;
}

.photo-date {
    color: #666;
    font-size: 12px;
    margin-top: 2px;
}

.photo-content {
    padding: 12px 16px;
    line-height: 1.5;
    color: #444;
}

.photo-error {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #999;
    font-size: 14px;
    background-color: #f8f8f8;
}

.photo-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #666;
    font-size: 14px;
    background-color: #f0f0f0;
}

/* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.photo-modal-content {
    max-width: 90vw;
    max-height: 90vh;
    padding: 20px;
}

.photo-view-container {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.photo-view-image {
    max-width: 100%;
    max-height: 70vh;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.photo-view-info {
    margin-top: 20px;
    text-align: center;
    max-width: 500px;
}

.photo-view-info h3 {
    margin: 0 0 8px 0;
    color: #333;
}

.photo-view-date {
    color: #666;
    font-size: 14px;
    margin-bottom: 12px;
}

.photo-view-caption {
    margin: 0;
    font-style: italic;
    color: #555;
    line-height: 1.6;
}

/* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
@media (max-width: 768px) {
    .photo-item {
        margin: 0 10px 15px;
        max-width: none;
    }
    
    .photo-container {
        height: 250px;
    }
    
    .photo-modal-content {
        margin: 20px;
        max-width: calc(100vw - 40px);
    }
    
    .photo-view-image {
        max-height: 60vh;
    }
}

@media (max-width: 480px) {
    .photo-container {
        height: 200px;
    }
    
    .photo-view-image {
        max-height: 50vh;
    }
}
</style>
`;

// ìŠ¤íƒ€ì¼ì„ headì— ì¶”ê°€
if (!document.querySelector('#photo-styles')) {
    const styleElement = document.createElement('style');
    styleElement.id = 'photo-styles';
    styleElement.innerHTML = photoStyles.replace(/<\/?style>/g, '');
    document.head.appendChild(styleElement);
}




</script>
<script src="./auto-logout.js"></script>
<script src="./delete-functionality.js"></script>
<script>
console.log('JavaScript íŒŒì¼ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤');
    // ì‚­ì œ ê¸°ëŠ¥ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
        const deleteManager = integrateDeleteFunctionality('https://memorial-api.seliscos.workers.dev');
    });
</script>
</body>
</html>